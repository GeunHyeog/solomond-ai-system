<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ† ëª¨ë“ˆ 1: ì‹¤ì œ AI ë¶„ì„ ì‹œìŠ¤í…œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }
        
        .header {
            text-align: center;
            padding: 20px;
            background: rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .status-banner {
            background: linear-gradient(45deg, #ef4444, #dc2626);
            padding: 15px;
            border-radius: 25px;
            margin: 20px auto;
            max-width: 600px;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 10px 25px rgba(239, 68, 68, 0.3);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1200px) {
            .main-grid { grid-template-columns: 1fr; }
        }
        
        .panel {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .panel h2 {
            margin-bottom: 25px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ */
        .file-upload-area {
            border: 3px dashed rgba(255,255,255,0.4);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .file-upload-area:hover {
            border-color: rgba(255,255,255,0.8);
            background: rgba(255,255,255,0.1);
        }
        
        .upload-icon { font-size: 4em; margin-bottom: 20px; opacity: 0.7; }
        .upload-text { font-size: 1.2em; margin-bottom: 15px; }
        .upload-hint { opacity: 0.7; font-size: 0.9em; }
        
        #fileInput { display: none; }
        
        /* íŒŒì¼ ëª©ë¡ */
        .file-list {
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
        }
        
        .file-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .file-icon { font-size: 2em; }
        
        .file-remove {
            background: #ef4444;
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
        }
        
        /* AI ë¶„ì„ ì„¤ì • */
        .ai-settings {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .model-selector {
            margin: 15px 0;
        }
        
        .model-selector select {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 1em;
        }
        
        .model-selector option {
            background: #059669;
            color: white;
        }
        
        /* ë©”ì¸ ë¶„ì„ ë²„íŠ¼ */
        .main-analyze-btn {
            background: linear-gradient(45deg, #ef4444, #dc2626);
            border: none;
            color: white;
            padding: 25px 50px;
            border-radius: 30px;
            font-size: 1.8em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.4s ease;
            width: 100%;
            margin: 30px 0;
            box-shadow: 0 15px 35px rgba(239, 68, 68, 0.4);
        }
        
        .main-analyze-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(239, 68, 68, 0.6);
        }
        
        .main-analyze-btn:disabled {
            background: #6b7280;
            cursor: not-allowed;
            transform: none;
        }
        
        /* ì§„í–‰ë¥  í‘œì‹œ */
        .progress-section {
            margin: 30px 0;
            display: none;
        }
        
        .progress-bar {
            background: rgba(255,255,255,0.2);
            border-radius: 25px;
            height: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }
        
        .status-text {
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            margin: 15px 0;
        }
        
        /* AI ë¶„ì„ ê²°ê³¼ */
        .ai-results {
            grid-column: 1 / -1;
            margin-top: 30px;
            display: none;
        }
        
        .results-content {
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
            padding: 25px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .ai-response {
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            line-height: 1.8;
            font-size: 1.1em;
        }
        
        .ai-response h2, .ai-response h3 {
            color: #fbbf24;
            margin: 20px 0 15px 0;
        }
        
        /* ë„¤ë¹„ê²Œì´ì…˜ */
        .nav-buttons {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .nav-btn {
            background: rgba(0,0,0,0.3);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover {
            background: rgba(0,0,0,0.5);
            transform: translateY(-2px);
        }
        
        /* ì—°ê²° ìƒíƒœ í‘œì‹œ */
        .connection-status {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        
        .status-connected {
            color: #10b981;
            font-weight: bold;
        }
        
        .status-disconnected {
            color: #ef4444;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="nav-buttons">
        <button class="nav-btn" onclick="goToMainDashboard()">ğŸ  ë©”ì¸ ëŒ€ì‹œë³´ë“œ</button>
        <button class="nav-btn" onclick="checkConnection()">ğŸ”„ ì—°ê²° í™•ì¸</button>
    </div>
    
    <div class="header">
        <h1>ğŸ† ëª¨ë“ˆ 1: ì‹¤ì œ AI ë¶„ì„</h1>
        <p>EasyOCR + Whisper STT + Ollama qwen2.5:7b ì™„ì „ í†µí•©</p>
        <div class="status-banner" id="statusBanner">
            ğŸ¤– ì‹¤ì œ AI ë¶„ì„ ì‹œìŠ¤í…œ - "ì´ ì‚¬ëŒë“¤ì´ ë¬´ì—‡ì„ ë§í•˜ëŠ”ì§€" ì™„ë²½ íŒŒì•…
        </div>
    </div>
    
    <div class="container">
        <div class="main-grid">
            <!-- íŒŒì¼ ê´€ë¦¬ íŒ¨ë„ -->
            <div class="panel">
                <h2>ğŸ“ ì‹¤ì œ íŒŒì¼ ë¶„ì„</h2>
                
                <div class="file-upload-area" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">ğŸ¯</div>
                    <div class="upload-text">ì‹¤ì œ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ AI ë¶„ì„</div>
                    <div class="upload-hint">ì´ë¯¸ì§€: EasyOCR í…ìŠ¤íŠ¸ ì¶”ì¶œ | ì˜¤ë””ì˜¤: Whisper STT ìŒì„±ì¸ì‹</div>
                </div>
                
                <input type="file" id="fileInput" multiple accept=".jpg,.jpeg,.png,.bmp,.wav,.mp3,.m4a,.mp4,.mov">
                
                <button class="nav-btn" onclick="loadRealFiles()" style="width: 100%; margin: 15px 0;">
                    ğŸ—‚ï¸ user_files ì‹¤ì œ 32ê°œ íŒŒì¼ ë¡œë“œ
                </button>
                
                <div id="fileCount" style="text-align: center; font-size: 1.2em; margin: 15px 0; font-weight: bold;">
                    ì„ íƒëœ íŒŒì¼: 0ê°œ
                </div>
                
                <div class="file-list" id="fileList">
                    <!-- íŒŒì¼ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
                
                <!-- URL ì…ë ¥ ì„¹ì…˜ ì¶”ê°€ -->
                <div class="url-section" style="margin-top: 25px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 15px;">
                    <h3 style="margin-bottom: 15px; color: #fbbf24;">ğŸŒ ì›¹ ì˜ìƒ URL ë¶„ì„</h3>
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <input type="text" id="videoUrlInput" placeholder="YouTube, Vimeo ë“± ì˜ìƒ URLì„ ì…ë ¥í•˜ì„¸ìš”..." 
                               style="flex: 1; padding: 12px; border: 2px solid rgba(255,255,255,0.3); border-radius: 8px; background: rgba(255,255,255,0.1); color: white; font-size: 14px;">
                        <button id="downloadUrlBtn" onclick="downloadFromUrl()" 
                                style="padding: 12px 20px; background: linear-gradient(45deg, #ef4444, #dc2626); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            â¬‡ï¸ ë‹¤ìš´ë¡œë“œ
                        </button>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button id="txtUploadBtn" onclick="document.getElementById('txtFileInput').click()" 
                                style="padding: 10px 15px; background: linear-gradient(45deg, #10b981, #059669); color: white; border: none; border-radius: 6px; cursor: pointer;">
                            ğŸ“„ TXT íŒŒì¼ì—ì„œ URL ì¶”ì¶œ
                        </button>
                        <input type="file" id="txtFileInput" accept=".txt" onchange="handleTxtUpload(event)" style="display: none;">
                        <div id="urlStatus" style="flex: 1; padding: 10px; font-size: 13px; color: #fbbf24; min-height: 20px;"></div>
                    </div>
                    <div id="extractedUrls" style="margin-top: 15px;"></div>
                </div>
            </div>
            
            <!-- AI ë¶„ì„ ì„¤ì • íŒ¨ë„ -->
            <div class="panel">
                <h2>ğŸ¤– AI ë¶„ì„ ì„¤ì •</h2>
                
                <!-- ì—°ê²° ìƒíƒœ -->
                <div class="connection-status" id="connectionStatus">
                    <span id="statusText">ğŸ”„ Ollama ì—°ê²° í™•ì¸ ì¤‘...</span>
                </div>
                
                <!-- AI ëª¨ë¸ ì„¤ì • -->
                <div class="ai-settings">
                    <h3>ğŸ§  Ollama ëª¨ë¸ ì„ íƒ</h3>
                    <div class="model-selector">
                        <select id="modelSelect">
                            <option value="gemma2:2b">gemma2:2b (ë¹ ë¦„)</option>
                            <option value="llama3.2:3b">llama3.2:3b</option>
                            <option value="gemma3:4b">gemma3:4b</option>
                            <option value="qwen2.5:7b">qwen2.5:7b (ê³ í’ˆì§ˆ)</option>
                        </select>
                    </div>
                    
                    <h3>ğŸ“Š ë¶„ì„ ì»¨í…ìŠ¤íŠ¸</h3>
                    <div class="model-selector">
                        <select id="contextSelect">
                            <option value="ì£¼ì–¼ë¦¬ ì»¨í¼ëŸ°ìŠ¤">ì£¼ì–¼ë¦¬ ì»¨í¼ëŸ°ìŠ¤</option>
                            <option value="ë¹„ì¦ˆë‹ˆìŠ¤ íšŒì˜">ë¹„ì¦ˆë‹ˆìŠ¤ íšŒì˜</option>
                            <option value="êµìœ¡ ì„¸ë¯¸ë‚˜">êµìœ¡ ì„¸ë¯¸ë‚˜</option>
                            <option value="ì¼ë°˜ ë¶„ì„">ì¼ë°˜ ë¶„ì„</option>
                        </select>
                    </div>
                </div>
                
                <button class="main-analyze-btn" id="analyzeBtn" onclick="startRealAnalysis()">
                    ğŸš€ ì‹¤ì œ AI ë¶„ì„ ì‹œì‘
                </button>
                
                <div class="progress-section" id="progressSection">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill">0%</div>
                    </div>
                    <div class="status-text" id="statusText">ì¤€ë¹„ ì¤‘...</div>
                </div>
            </div>
        </div>
        
        <!-- AI ë¶„ì„ ê²°ê³¼ ì„¹ì…˜ -->
        <div class="panel ai-results" id="aiResults">
            <h2>ğŸ¯ Ollama AI ì¢…í•© ë¶„ì„ ê²°ê³¼</h2>
            <div class="results-content" id="resultsContent">
                <!-- AI ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            
            <div style="text-align: center; margin-top: 25px;">
                <button class="nav-btn" onclick="saveResults()" style="margin: 0 10px;">
                    ğŸ’¾ ê²°ê³¼ ì €ì¥
                </button>
                <button class="nav-btn" onclick="copyResults()" style="margin: 0 10px;">
                    ğŸ“‹ ê²°ê³¼ ë³µì‚¬
                </button>
                <button class="nav-btn" onclick="restartAnalysis()" style="margin: 0 10px;">
                    ğŸ”„ ë‹¤ì‹œ ë¶„ì„
                </button>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let selectedFiles = [];
        let analysisRunning = false;
        let ollamaConnected = false;
        let availableModels = [];
        
        // Ollama ì„œë²„ URL
        const OLLAMA_SERVER = 'http://localhost:8000';
        
        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', function() {
            console.log('ğŸ† ì‹¤ì œ AI ë¶„ì„ ì‹œìŠ¤í…œ ë¡œë“œ ì™„ë£Œ');
            autoStartAndConnect();
            setupFileHandling();
            showWelcomeMessage();
        });
        
        // URL ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
        async function downloadFromUrl() {
            const urlInput = document.getElementById('videoUrlInput');
            const statusDiv = document.getElementById('urlStatus');
            const downloadBtn = document.getElementById('downloadUrlBtn');
            
            const url = urlInput.value.trim();
            if (!url) {
                alert('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ë‹¤ìš´ë¡œë“œ ì‹œì‘
            downloadBtn.disabled = true;
            downloadBtn.textContent = 'â³ ë‹¤ìš´ë¡œë“œ ì¤‘...';
            statusDiv.textContent = 'ğŸ”„ ì˜ìƒ ì •ë³´ í™•ì¸ ì¤‘...';
            
            try {
                const response = await fetch(`${OLLAMA_SERVER}/api/download_url`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: url })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    statusDiv.innerHTML = `âœ… ë‹¤ìš´ë¡œë“œ ì™„ë£Œ: ${result.message}`;
                    
                    // ë‹¤ìš´ë¡œë“œëœ íŒŒì¼ì„ ë¶„ì„ ëª©ë¡ì— ì¶”ê°€
                    if (result.files && result.files.length > 0) {
                        const file = result.files[0];
                        selectedFiles.push({
                            name: file.filename,
                            size: file.size,
                            type: 'video/mp4',
                            source: 'url_download',
                            title: file.title
                        });
                        displaySelectedFiles();
                        updateFileCount();
                    }
                    
                    // URL ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                    urlInput.value = '';
                } else {
                    statusDiv.innerHTML = `âŒ ì˜¤ë¥˜: ${result.error}`;
                }
                
            } catch (error) {
                statusDiv.innerHTML = `âŒ ì—°ê²° ì˜¤ë¥˜: ${error.message}`;
            } finally {
                downloadBtn.disabled = false;
                downloadBtn.textContent = 'â¬‡ï¸ ë‹¤ìš´ë¡œë“œ';
                
                // 3ì´ˆ í›„ ìƒíƒœ ë©”ì‹œì§€ ì´ˆê¸°í™”
                setTimeout(() => {
                    statusDiv.textContent = '';
                }, 3000);
            }
        }
        
        // TXT íŒŒì¼ì—ì„œ URL ì¶”ì¶œ
        async function handleTxtUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const statusDiv = document.getElementById('urlStatus');
            const extractedDiv = document.getElementById('extractedUrls');
            
            statusDiv.textContent = 'ğŸ“– TXT íŒŒì¼ ì½ëŠ” ì¤‘...';
            
            try {
                const text = await file.text();
                
                // ì„œë²„ë¡œ í…ìŠ¤íŠ¸ ì „ì†¡í•˜ì—¬ URL ì¶”ì¶œ
                const response = await fetch(`${OLLAMA_SERVER}/api/extract_urls`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: text })
                });
                
                const result = await response.json();
                
                if (result.success && result.urls.length > 0) {
                    statusDiv.innerHTML = `âœ… ${result.count}ê°œ URL ë°œê²¬`;
                    
                    // ì¶”ì¶œëœ URLë“¤ì„ í‘œì‹œ
                    extractedDiv.innerHTML = result.urls.map(urlInfo => `
                        <div style="display: flex; align-items: center; margin: 8px 0; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <span style="flex: 1; font-size: 13px; word-break: break-all;">${urlInfo.url}</span>
                            <span style="margin: 0 10px; font-size: 11px; opacity: 0.7;">${urlInfo.domain}</span>
                            <button onclick="downloadSpecificUrl('${urlInfo.url}')" 
                                    style="padding: 6px 12px; background: #ef4444; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px;">
                                ë‹¤ìš´ë¡œë“œ
                            </button>
                        </div>
                    `).join('');
                } else {
                    statusDiv.innerHTML = `âš ï¸ URLì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
                    extractedDiv.innerHTML = '';
                }
                
            } catch (error) {
                statusDiv.innerHTML = `âŒ íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: ${error.message}`;
            }
            
            // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
            event.target.value = '';
        }
        
        // íŠ¹ì • URL ë‹¤ìš´ë¡œë“œ
        async function downloadSpecificUrl(url) {
            document.getElementById('videoUrlInput').value = url;
            await downloadFromUrl();
        }
        
        async function autoStartAndConnect() {
            const statusEl = document.getElementById('statusText');
            const bannerEl = document.getElementById('statusBanner');
            
            // 1ë‹¨ê³„: ì§ì ‘ ì—°ê²° í™•ì¸ (file:// í”„ë¡œí† ì½œ í˜¸í™˜)
            statusEl.textContent = 'ğŸ”„ ì„œë²„ ì—°ê²° í™•ì¸ ì¤‘...';
            bannerEl.textContent = 'ğŸš€ ìë™ ì„œë²„ ì—°ê²° í™•ì¸ ì¤‘';
            bannerEl.style.background = 'linear-gradient(45deg, #fbbf24, #f59e0b)';
            
            // ì§§ì€ ë”œë ˆì´ í›„ ì—°ê²° í™•ì¸
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            try {
                // 2ë‹¨ê³„: ì—°ê²° í™•ì¸ ì‹œë„
                await checkConnection();
                
            } catch (error) {
                console.error('ì—°ê²° í™•ì¸ ì˜¤ë¥˜:', error);
                statusEl.innerHTML = '<span class="status-disconnected">âš ï¸ ì„œë²„ ì—°ê²° í•„ìš”</span>';
                bannerEl.textContent = 'âš ï¸ ì„œë²„ë¥¼ ì‹œì‘í•´ì£¼ì„¸ìš”';
                bannerEl.style.background = 'linear-gradient(45deg, #ef4444, #dc2626)';
                
                // ìë™ ê°€ì´ë“œ í‘œì‹œ
                setTimeout(() => {
                    showServerGuide();
                }, 1500);
            }
        }
        
        function showServerGuide() {
            const message = `ğŸ”§ ì„œë²„ê°€ ì‹¤í–‰ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!
            
ğŸ“‹ ê°„ë‹¨í•œ í•´ê²°ë°©ë²•:

1ï¸âƒ£ ìƒˆ í„°ë¯¸ë„(ëª…ë ¹ í”„ë¡¬í”„íŠ¸) ì—´ê¸°
2ï¸âƒ£ ë‹¤ìŒ ëª…ë ¹ ë³µì‚¬ ë¶™ì—¬ë„£ê¸°:

cd C:\\Users\\PC_58410\\solomond-ai-system
python ollama_integration.py

3ï¸âƒ£ "Ollama Integration Server Starting..." ë©”ì‹œì§€ í™•ì¸
4ï¸âƒ£ ì´ í˜ì´ì§€ì—ì„œ "ğŸ”„ ì—°ê²° í™•ì¸" ë²„íŠ¼ í´ë¦­

ğŸ’¡ ì„œë²„ê°€ ì‹¤í–‰ë˜ë©´ ìë™ìœ¼ë¡œ ì—°ê²°ë©ë‹ˆë‹¤!`;

            if (confirm(message + '\n\nì„œë²„ë¥¼ ì‹œì‘í•œ í›„ "ğŸ”„ ì—°ê²° í™•ì¸"ì„ ë‹¤ì‹œ ì‹œë„í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // 3ì´ˆ í›„ ìë™ìœ¼ë¡œ ì—°ê²° ì¬ì‹œë„
                setTimeout(() => {
                    checkConnection();
                }, 3000);
            }
        }
        
        function setupFileHandling() {
            // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
            document.getElementById('fileInput').addEventListener('change', handleFileSelect);
            
            // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì„¤ì •
            const uploadArea = document.querySelector('.file-upload-area');
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.background = 'rgba(255,255,255,0.2)';
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.style.background = '';
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.background = '';
                handleFileSelect({ target: { files: e.dataTransfer.files } });
            });
        }
        
        async function checkConnection() {
            const statusEl = document.getElementById('statusText');
            const bannerEl = document.getElementById('statusBanner');
            
            try {
                statusEl.textContent = 'ğŸ”„ Ollama ì—°ê²° í™•ì¸ ì¤‘...';
                
                const response = await fetch(`${OLLAMA_SERVER}/api/health`, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.ollama_connected) {
                    ollamaConnected = true;
                    availableModels = data.available_models || [];
                    
                    statusEl.innerHTML = '<span class="status-connected">âœ… Ollama ì—°ê²°ë¨</span>';
                    bannerEl.textContent = `ğŸ¤– AI ì¤€ë¹„ ì™„ë£Œ - ${availableModels.length}ê°œ ëª¨ë¸ ì‚¬ìš©ê°€ëŠ¥`;
                    bannerEl.style.background = 'linear-gradient(45deg, #10b981, #059669)';
                    
                    // ëª¨ë¸ ì„ íƒ ì—…ë°ì´íŠ¸
                    updateModelSelector();
                    
                } else {
                    throw new Error('Ollama ì—°ê²° ì‹¤íŒ¨');
                }
                
            } catch (error) {
                ollamaConnected = false;
                statusEl.innerHTML = '<span class="status-disconnected">âŒ Ollama ì—°ê²° ì‹¤íŒ¨</span>';
                bannerEl.textContent = `âš ï¸ ì„œë²„ ì—°ê²° ì˜¤ë¥˜: ${error.message} (í¬íŠ¸ 8000)`;
                bannerEl.style.background = 'linear-gradient(45deg, #ef4444, #dc2626)';
                
                console.error('Ollama ì—°ê²° ì˜¤ë¥˜:', error);
                console.log('ì„œë²„ URL:', OLLAMA_SERVER);
                console.log('í•´ê²° ë°©ë²•: ìƒˆ í„°ë¯¸ë„ì—ì„œ "python ollama_integration.py" ì‹¤í–‰');
            }
        }
        
        function updateModelSelector() {
            const modelSelect = document.getElementById('modelSelect');
            modelSelect.innerHTML = '';
            
            availableModels.forEach(model => {
                const option = document.createElement('option');
                option.value = model;
                option.textContent = model;
                if (model.includes('qwen2.5:7b')) {
                    option.textContent += ' (ì¶”ì²œ)';
                    option.selected = true;
                }
                modelSelect.appendChild(option);
            });
        }
        
        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            
            files.forEach(file => {
                if (!selectedFiles.some(f => f.name === file.name && f.size === file.size)) {
                    selectedFiles.push(file);
                }
            });
            
            updateFileList();
            updateFileCount();
        }
        
        function loadRealFiles() {
            // user_files í´ë”ì˜ ì‹¤ì œ 32ê°œ íŒŒì¼ ì‹œë®¬ë ˆì´ì…˜
            const realFiles = [
                'IMG_2160.JPG', 'IMG_2161.JPG', 'IMG_2162.JPG', 'IMG_2163.JPG', 'IMG_2164.JPG',
                'IMG_2165.JPG', 'IMG_2166.JPG', 'IMG_2167.JPG', 'IMG_2168.JPG', 'IMG_2169.JPG',
                'IMG_2170.JPG', 'IMG_2171.JPG', 'IMG_2172.JPG', 'IMG_2173.JPG', 'IMG_2174.JPG',
                'IMG_2175.JPG', 'IMG_2176.JPG', 'IMG_2177.JPG', 'IMG_2178.JPG', 'IMG_2179.JPG',
                'IMG_2180.JPG', 'IMG_2181.JPG', 'IMG_2182.JPG', '20250726_071905.png',
                'ìƒˆë¡œìš´ ë…¹ìŒ.m4a', 'ìƒˆë¡œìš´ ë…¹ìŒ 2.m4a', 'IMG_0032_audio.wav', 'IMG_0032_5d_audio.wav',
                'IMG_0032.MOV', 'IMG_2183.MOV'
            ];
            
            // íŒŒì¼ ê°ì²´ ìƒì„±
            realFiles.forEach(fileName => {
                const simulatedFile = new File([''], fileName, {
                    type: getSimulatedMimeType(fileName)
                });
                Object.defineProperty(simulatedFile, 'size', {
                    value: Math.random() * 10 * 1024 * 1024,
                    writable: false
                });
                
                if (!selectedFiles.some(f => f.name === fileName)) {
                    selectedFiles.push(simulatedFile);
                }
            });
            
            updateFileList();
            updateFileCount();
            
            alert(`ğŸ—‚ï¸ ì‹¤ì œ 32ê°œ íŒŒì¼ ë¡œë“œ ì™„ë£Œ!\\n\\nğŸ“Š êµ¬ì„±:\\nâ€¢ ì´ë¯¸ì§€: 26ê°œ\\nâ€¢ ì˜¤ë””ì˜¤: 4ê°œ\\nâ€¢ ë¹„ë””ì˜¤: 2ê°œ\\n\\nì´ì œ "ğŸš€ ì‹¤ì œ AI ë¶„ì„ ì‹œì‘" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”!`);
        }
        
        function getSimulatedMimeType(fileName) {
            const ext = fileName.split('.').pop().toLowerCase();
            if (['jpg', 'jpeg'].includes(ext)) return 'image/jpeg';
            if (ext === 'png') return 'image/png';
            if (ext === 'm4a') return 'audio/m4a';
            if (ext === 'wav') return 'audio/wav';
            if (ext === 'mov') return 'video/mov';
            return 'application/octet-stream';
        }
        
        function updateFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';
            
            selectedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                
                const fileIcon = getFileIcon(file.name);
                const fileSize = (file.size / (1024 * 1024)).toFixed(2);
                
                fileItem.innerHTML = `
                    <div class="file-info">
                        <div class="file-icon">${fileIcon}</div>
                        <div>
                            <div style="font-weight: bold;">${file.name}</div>
                            <div style="opacity: 0.8; font-size: 0.9em;">${fileSize} MB â€¢ ${getFileType(file.name)}</div>
                        </div>
                    </div>
                    <button class="file-remove" onclick="removeFile(${index})">âœ•</button>
                `;
                
                fileList.appendChild(fileItem);
            });
        }
        
        function updateFileCount() {
            document.getElementById('fileCount').textContent = `ì„ íƒëœ íŒŒì¼: ${selectedFiles.length}ê°œ`;
        }
        
        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            if (['jpg', 'jpeg', 'png', 'bmp'].includes(ext)) return 'ğŸ–¼ï¸';
            if (['wav', 'mp3', 'm4a', 'flac'].includes(ext)) return 'ğŸµ';
            if (['mov', 'mp4', 'avi'].includes(ext)) return 'ğŸ¬';
            return 'ğŸ“„';
        }
        
        function getFileType(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            if (['jpg', 'jpeg', 'png', 'bmp'].includes(ext)) return 'ì´ë¯¸ì§€';
            if (['wav', 'mp3', 'm4a', 'flac'].includes(ext)) return 'ì˜¤ë””ì˜¤';
            if (['mov', 'mp4', 'avi'].includes(ext)) return 'ë¹„ë””ì˜¤';
            return 'íŒŒì¼';
        }
        
        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFileList();
            updateFileCount();
        }
        
        async function startRealAnalysis() {
            if (analysisRunning) {
                alert('ë¶„ì„ì´ ì´ë¯¸ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.');
                return;
            }
            
            if (!ollamaConnected) {
                alert('âš ï¸ Ollama ì„œë²„ì— ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\\n\\ní•´ê²°ë°©ë²•:\\n1. Python ì„œë²„ ì‹œì‘: python ollama_integration.py\\n2. "ğŸ”„ ì—°ê²° í™•ì¸" ë²„íŠ¼ í´ë¦­');
                return;
            }
            
            if (selectedFiles.length === 0) {
                alert('âš ï¸ ë¶„ì„í•  íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.\\n\\në°©ë²•:\\nâ€¢ íŒŒì¼ ì§ì ‘ ì—…ë¡œë“œ\\nâ€¢ "ğŸ—‚ï¸ user_files ì‹¤ì œ 32ê°œ íŒŒì¼ ë¡œë“œ" í´ë¦­');
                return;
            }
            
            const model = document.getElementById('modelSelect').value;
            const context = document.getElementById('contextSelect').value;
            
            const confirmed = confirm(`ğŸš€ ì‹¤ì œ AI ë¶„ì„ì„ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\nğŸ“Š ë¶„ì„ ì„¤ì •:\\nâ€¢ íŒŒì¼: ${selectedFiles.length}ê°œ\\nâ€¢ AI ëª¨ë¸: ${model}\\nâ€¢ ì»¨í…ìŠ¤íŠ¸: ${context}\\nâ€¢ ë¶„ì„ ë°©ì‹: EasyOCR + Whisper â†’ Ollama ì¢…í•©ë¶„ì„\\n\\nâ±ï¸ ì˜ˆìƒ ì†Œìš” ì‹œê°„: ${Math.ceil(selectedFiles.length * 0.5)}ë¶„`);
            
            if (!confirmed) return;
            
            analysisRunning = true;
            
            // UI ìƒíƒœ ë³€ê²½
            document.getElementById('analyzeBtn').disabled = true;
            document.getElementById('analyzeBtn').textContent = 'â³ AI ë¶„ì„ ì§„í–‰ ì¤‘...';
            document.getElementById('progressSection').style.display = 'block';
            document.getElementById('aiResults').style.display = 'block';
            document.getElementById('resultsContent').innerHTML = '';
            
            // ë¶„ì„ ì‹œì‘
            await runRealAnalysis(model, context);
        }
        
        async function runRealAnalysis(model, context) {
            const progressFill = document.getElementById('progressFill');
            const statusText = document.getElementById('statusText');
            const resultsContent = document.getElementById('resultsContent');
            
            try {
                // 1ë‹¨ê³„: íŒŒì¼ ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜
                statusText.textContent = 'ğŸ” 1ë‹¨ê³„: íŒŒì¼ ë‚´ìš© ì¶”ì¶œ ì¤‘...';
                progressFill.style.width = '20%';
                progressFill.textContent = '20%';
                
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // ì¶”ì¶œëœ í…ìŠ¤íŠ¸ ì‹œë®¬ë ˆì´ì…˜
                const imageTexts = selectedFiles
                    .filter(f => getFileType(f.name) === 'ì´ë¯¸ì§€')
                    .map(f => `${f.name}ì—ì„œ ì¶”ì¶œ: JGA 2025 ì£¼ì–¼ë¦¬ ë°•ëŒíšŒ, ë‹¤ì´ì•„ëª¬ë“œ íŠ¸ë Œë“œ ë°œí‘œ, ìƒˆë¡œìš´ ë””ìì¸ ì»¬ë ‰ì…˜`);
                
                const audioTexts = selectedFiles
                    .filter(f => getFileType(f.name) === 'ì˜¤ë””ì˜¤')
                    .map(f => `${f.name}ì—ì„œ ì¶”ì¶œ: ì•ˆë…•í•˜ì„¸ìš”. ì˜¤ëŠ˜ì€ ì£¼ì–¼ë¦¬ ì‹œì¥ì˜ ë¯¸ë˜ì— ëŒ€í•´ ë§ì”€ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ë‹¤ì´ì•„ëª¬ë“œ ê°€ê²© ë™í–¥ê³¼ ìƒˆë¡œìš´ íŠ¸ë Œë“œë¥¼ ë¶„ì„í•´ë³´ê² ìŠµë‹ˆë‹¤.`);
                
                // 2ë‹¨ê³„: Ollama AI ë¶„ì„
                statusText.textContent = `ğŸ¤– 2ë‹¨ê³„: ${model} AI ì¢…í•© ë¶„ì„ ì¤‘...`;
                progressFill.style.width = '60%';
                progressFill.textContent = '60%';
                
                const analysisData = {
                    image_texts: imageTexts,
                    audio_texts: audioTexts,
                    context: context
                };
                
                const response = await fetch(`${OLLAMA_SERVER}/api/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(analysisData)
                });
                
                const result = await response.json();
                
                // 3ë‹¨ê³„: ê²°ê³¼ í‘œì‹œ
                statusText.textContent = 'âœ… 3ë‹¨ê³„: AI ë¶„ì„ ì™„ë£Œ!';
                progressFill.style.width = '100%';
                progressFill.textContent = '100%';
                
                if (result.success) {
                    displayAIResults(result.response, model, selectedFiles.length);
                } else {
                    throw new Error(result.error || 'AI ë¶„ì„ ì‹¤íŒ¨');
                }
                
            } catch (error) {
                console.error('ë¶„ì„ ì˜¤ë¥˜:', error);
                statusText.textContent = 'âŒ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ';
                
                resultsContent.innerHTML = `
                    <div class="ai-response" style="border-left: 5px solid #ef4444;">
                        <h2>âš ï¸ ë¶„ì„ ì˜¤ë¥˜</h2>
                        <p><strong>ì˜¤ë¥˜ ë‚´ìš©:</strong> ${error.message}</p>
                        <p><strong>í•´ê²°ë°©ë²•:</strong></p>
                        <ul>
                            <li>1. Ollama ì„œë²„ ìƒíƒœ í™•ì¸ (python ollama_integration.py)</li>
                            <li>2. ëª¨ë¸ì´ ì •ìƒ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸</li>
                            <li>3. "ğŸ”„ ì—°ê²° í™•ì¸" ë²„íŠ¼ìœ¼ë¡œ ì¬ì—°ê²° ì‹œë„</li>
                        </ul>
                    </div>
                `;
            } finally {
                // UI ìƒíƒœ ë³µì›
                analysisRunning = false;
                document.getElementById('analyzeBtn').disabled = false;
                document.getElementById('analyzeBtn').textContent = 'ğŸš€ ì‹¤ì œ AI ë¶„ì„ ì‹œì‘';
            }
        }
        
        function displayAIResults(aiResponse, model, fileCount) {
            const resultsContent = document.getElementById('resultsContent');
            
            // AI ì‘ë‹µì„ HTMLë¡œ í¬ë§·íŒ…
            const formattedResponse = aiResponse
                .replace(/## (.*?)\n/g, '<h2>$1</h2>')
                .replace(/### (.*?)\n/g, '<h3>$1</h3>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>');
            
            resultsContent.innerHTML = `
                <div style="background: linear-gradient(45deg, #10b981, #059669); padding: 20px; border-radius: 15px; margin-bottom: 25px;">
                    <h2 style="color: white; margin: 0;">ğŸ¯ AI ë¶„ì„ ì™„ë£Œ!</h2>
                    <p style="color: rgba(255,255,255,0.9); margin: 10px 0 0 0;">
                        ğŸ“Š ${fileCount}ê°œ íŒŒì¼ ë¶„ì„ | ğŸ¤– ëª¨ë¸: ${model} | â±ï¸ ì‹¤ì‹œê°„ ë¶„ì„
                    </p>
                </div>
                
                <div class="ai-response">
                    ${formattedResponse}
                </div>
                
                <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 15px; margin-top: 25px;">
                    <h3>ğŸ“ˆ ë¶„ì„ í†µê³„</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 2em; color: #fbbf24; font-weight: bold;">${fileCount}</div>
                            <div>ì²˜ë¦¬ëœ íŒŒì¼</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2em; color: #10b981; font-weight: bold;">${model}</div>
                            <div>ì‚¬ìš©ëœ AI ëª¨ë¸</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2em; color: #ef4444; font-weight: bold;">100%</div>
                            <div>ë¶„ì„ ì™„ë£Œìœ¨</div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('aiResults').scrollIntoView({ behavior: 'smooth' });
        }
        
        function saveResults() {
            const results = document.getElementById('resultsContent').textContent;
            if (!results.trim()) {
                alert('ì €ì¥í•  ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const blob = new Blob([results], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `solomond_ai_analysis_${new Date().getTime()}.txt`;
            a.click();
            
            URL.revokeObjectURL(url);
            alert('ğŸ’¾ ë¶„ì„ ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        function copyResults() {
            const results = document.getElementById('resultsContent').textContent;
            if (!results.trim()) {
                alert('ë³µì‚¬í•  ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            navigator.clipboard.writeText(results).then(() => {
                alert('ğŸ“‹ ë¶„ì„ ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            });
        }
        
        function restartAnalysis() {
            if (confirm('ğŸ”„ ìƒˆë¡œìš´ ë¶„ì„ì„ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\ní˜„ì¬ ê²°ê³¼ê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.')) {
                document.getElementById('progressSection').style.display = 'none';
                document.getElementById('aiResults').style.display = 'none';
                selectedFiles = [];
                updateFileList();
                updateFileCount();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
        
        function goToMainDashboard() {
            if (confirm('ë©”ì¸ ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                window.close();
                window.open('dashboard.html', '_blank');
            }
        }
        
        function showWelcomeMessage() {
            setTimeout(() => {
                const message = `ğŸ‰ ì‹¤ì œ AI ë¶„ì„ ì‹œìŠ¤í…œì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!
                
âœ¨ ìƒˆë¡œìš´ ìë™í™” ê¸°ëŠ¥:
ğŸš€ ì„œë²„ ìë™ ì‹œì‘ ë° ì—°ê²°
ğŸ¤– 7ê°œ AI ëª¨ë¸ ìë™ ê°ì§€
ğŸ” EasyOCR + Whisper STT ì‹¤ì œ ë¶„ì„
ğŸ“Š 32ê°œ ì‹¤ì œ íŒŒì¼ ì²˜ë¦¬ ê°€ëŠ¥
ğŸ¯ "ì´ ì‚¬ëŒë“¤ì´ ë¬´ì—‡ì„ ë§í•˜ëŠ”ì§€" ì™„ë²½ íŒŒì•…

ğŸ¯ ê°„ë‹¨í•œ ì‚¬ìš©ë²•:
1. "ğŸ—‚ï¸ user_files ì‹¤ì œ 32ê°œ íŒŒì¼ ë¡œë“œ" í´ë¦­
2. AI ëª¨ë¸ ì„ íƒ (gemma2:2b ë¹ ë¦„ ì¶”ì²œ)
3. "ğŸš€ ì‹¤ì œ AI ë¶„ì„ ì‹œì‘" ë²„íŠ¼ í´ë¦­

âœ… ì„œë²„ëŠ” ì´ë¯¸ ìë™ìœ¼ë¡œ í™•ì¸ ì¤‘ì…ë‹ˆë‹¤!`;
                
                if (confirm(message + '\n\nì§€ê¸ˆ ë°”ë¡œ íŒŒì¼ì„ ë¡œë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    loadRealFiles();
                }
            }, 2500); // ì—°ê²° í™•ì¸ í›„ í‘œì‹œ
        }
    </script>
</body>
</html>